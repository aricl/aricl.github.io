/**
 * jquery.XhrToggle
 *
 * This is the custom Jquery that handles a clickable table cell value
 * that toggles state. It was built for the ticket flagging feature.
 */
;(function( $ ){
    var methods = {

        /**
         * Constructor
         */
        init : function() {
            return $(this);
        },

        /**
         * Update
         */
        setup : function(options) {
            $(document).on('click', '.' + options.class, function (event) {
                event.preventDefault();
                $.ajax({
                    url: $(this).attr('href'),
                    type: 'get',
                    headers: {
                        'Cache-Control': 'max-age=3600'
                    },
                    success: function () {
                        $('.dataTables_scrollBody').each(function () {
                            var oTable = $(this).Table();
                            var oSettings = oTable.fnSettings();

                            // Only refresh table if it's an ajax data source table
                            if (oSettings.oInit.sAjaxSource !== null) {
                                oTable.fnReloadAjax();
                                oTable.fnDraw();
                            }
                        });
                    },
                    error: function (request) {
                        console.log(request.responseText);
                    }
                });
            });

            return $(this);
        }
    };

    /**
     * Setup method handler
     */
    $.fn.XhrToggle = function( method ) {
        if ( methods[method] ) {
            return methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 ));
        } else if ( typeof method === 'object' || ! method ) {
            return methods.init.apply( this, arguments );
        } else {
            $.error( 'Method ' +  method + ' does not exist on jQuery.Notifications' );
        }
    };
})( jQuery );
